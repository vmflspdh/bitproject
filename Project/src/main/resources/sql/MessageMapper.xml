<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="test.dao.MessageDao">
  <resultMap type="Message" id="messageMap">
    <id column="MSGNO" property="messageNo"/>
    <result column="MNO2" property="sendMemberNo"/>
    <result column="MNO" property="receiveMemberNo"/>
    <result column="MNM" property="receiveUser"/>
    <result column="CONT" property="contents"/>
    <result column="SD_DT" property="sendDate"/>
    <result column="STAT" property="state"/>
    <result column="MPHO" property="myPhoto"/>
  </resultMap>
  
<insert id="insert" parameterType="Message">
insert into tvl_msg(mno2, mno, cont, sd_dt) 
values(#{sendMemberNo}, #{receiveMemberNo}, #{contents}, now())
</insert>
  
<select id="selectMyMemberList" resultMap="messageMap" parameterType="map">
select tvl_msg.mno, mnm, msgno, mno2, cont, sd_dt, mpho 
from tvl_msg
inner join tvl_membs on tvl_msg.mno2 = tvl_membs.mno 
where msgno in (
select max(msgno)
from tvl_msg
inner join tvl_membs on tvl_msg.mno2 = tvl_membs.mno 
where tvl_msg.mno = #{receiveNo}
group by mno2
)
order by msgno desc;
<!-- order by msgno desc;
select tvl_msg.mno, mnm, msgno, mno2, cont, sd_dt, mpho from tvl_msg
inner join tvl_membs on tvl_msg.mno2 = tvl_membs.mno 
where tvl_msg.mno = #{receiveNo}
order by msgno desc -->
</select>

<select id="selectMyMessageList" resultMap="messageMap" parameterType="map">
select tvl_msg.mno, mnm, msgno, mno2, cont, sd_dt, mpho from tvl_msg
inner join tvl_membs on tvl_msg.mno2 = tvl_membs.mno 
where (mno2=#{sendNo} and tvl_msg.mno=#{receiveNo}) or (mno2=#{receiveNo} and tvl_msg.mno=#{sendNo})
order by
<choose>
<when test="msgnoOrder == 'desc'">msgno desc</when>
<otherwise>msgno asc</otherwise>
</choose>
</select>
</mapper>
