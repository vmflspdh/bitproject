<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="test.dao.RegistFormDao">
	<resultMap type="RegistForm" id="registFormMap">
	<id column="TMNO" property="travelMainNo" />
		<result column="MNO" property="memberNo" />
		<result column="STYNO" property="styleNo" />
		<result column="MNM" property="writer" />
		<result column="TITLE" property="title" />
		<result column="STYNM" property="styleName" />
		<result column="SF_INF" property="selfIntroduce" />
		<result column="MPHO" property="myPhoto" />

		<collection column="TMNO" property="schedule" ofType="schedule"
			javaType="ArrayList" resultMap="scheduleMap" />

	</resultMap>

  <resultMap type="schedule" id="scheduleMap">
  <id column="TMNO" property="travelMainNo" />
  <result column="SCHNO" property="scheduleNo"/>
  <result column="LOCNO" property="locationNo" />
    <result column="ST_DT" property="startDate" />
    <result column="ED_DT" property="endDate" />
  </resultMap>

	<select id="selectList" resultMap="registFormMap" parameterType="map">
		SELECT * from tvl_tvlmain
    inner join tvl_membs
		on tvl_membs.mno = tvl_tvlmain.mno 
		inner join tvl_sch
		on tvl_sch.tmno = tvl_tvlmain.tmno
		order by
		<choose>
			<when test="schnoOrder == 'asc'">schno asc</when>
			<otherwise>schno desc</otherwise>
		</choose>
	</select>

	<select id="selectOne" resultMap="registFormMap" parameterType="int">
		select tvl_membs.mno, tvl_tvlmain.tmno, title, mnm,
		tvl_sty.styno, stynm, sf_inf, mpho from tvl_tvlmain
		inner join tvl_membs
		on tvl_membs.mno = tvl_tvlmain.mno
		inner join tvl_mysty
		on tvl_mysty.tmno = tvl_tvlmain.tmno
		inner join tvl_sty
		on tvl_sty.styno = tvl_mysty.styno
		where tvl_tvlmain.tmno = #{value};
	</select>
</mapper>

